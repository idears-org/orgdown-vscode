# Org Mode TextMate Grammar Template
#
# ==============================================================================
# GRAMMAR STRUCTURE
# ==============================================================================
# This grammar is organized hierarchically to mirror the logical structure of
# an Org Mode document, as outlined in ADR-007. The YAML file is the single
# source of truth for this structure.
#
# document-root
# ├── file-header
# │   ├── line-comments
# │   ├── blocks
# │   │   ├── begin-end-blocks
# │   │   │   ├── comment-block
# │   │   │   ├── standard-blocks -> includes #inline-markup
# │   │   │   ├── dynamic-blocks -> includes #inline-markup
# │   │   │   ├── org-src-blocks (injected)
# │   │   │   └── customized-blocks -> includes #inline-markup
# │   │   ├── latex-environment-block
# │   │   ├── drawer-blocks
# │   │   │   ├── property-drawer
# │   │   │   │   └── property-line
# │   │   │   └── drawers
# │   │   ├── tables
# │   │   └── horizontal-rules
# │   ├── keyword-like-lines
# │   │   ├── include-directive
# │   │   ├── planning-lines -> includes #timestamps
# │   │   ├── link-abbreviations
# │   │   ├── macro-definition
# │   │   └── keywords
# │   ├── lists -> includes #inline-markup
# │   └── paragraph -> includes #inline-markup
# │
# └── outline
#     ├── outline-level-1 (active & inactive variants)
#     │   ├── outline-level-[2,6+] (active & inactive variants)
#     │   │   ├── outline-level-[3,6+] (active & inactive variants)
#     │   │   │   ├── ......
#     │   │   ├── headline-block (in begin rule) -> includes #inline-markup
#     │   │   └── section-content
#     │   ├── headline-block (in begin rule) -> includes #inline-markup
#     │   └── section-content
#     │       ├── line-comments (reused)
#     │       ├── blocks (reused)
#     │       ├── keyword-like-lines (reused)
#     │       ├── lists (reused)
#     │       └── paragraph (reused)
#     ├── outline-level-2 (active & inactive variants)
#     │   └── ......
#     │   ......
#     └── outline-level-more-than-6 (active & inactive variants)
#         └── ......
#
# --- Included Patterns (via anchors or direct includes) ---
#
# inline-markup (anchor: &inline-markup-patterns)
# ├── plain-link
# ├── angle-bracket-link
# ├── links
# │   └── link-protocol
# ├── timestamps
# ├── footnotes
# ├── macros
# ├── latex-inline
# ├── bold -> includes #inline-markup
# ├── italic -> includes #inline-markup
# ├── underline -> includes #inline-markup
# ├── strikethrough -> includes #inline-markup
# ├── code
# ├── verbatim
# ├── entities
# └── sub-super-scripts
#
# ==============================================================================

fileTypes: [org]
name: Org Mode
scopeName: "{{scopes.META_DOCUMENT}}"
patterns:
  - include: "#document-root"

repository:
  #region Anchors
  # Anchor used across many features; defined within this region for cohesion
  inline-markup-patterns: &inline-markup-patterns
    - include: "#plain-link"
    - include: "#angle-bracket-link"
    - include: "#links"
    - include: "#timestamps"
    - include: "#footnotes"
    - include: "#macros"
    - include: "#latex-inline"
    - include: "#bold"
    - include: "#italic"
    - include: "#underline"
    - include: "#strikethrough"
    - include: "#code"
    - include: "#verbatim"
    - include: "#entities"
    - include: "#sub-super-scripts"
  #endregion

  #region Top-Level Structure
  document-root:
    patterns:
      - include: "#file-header"
      - include: "#outline"

  outline:
    patterns:
      - include: "#outline-inactive-level-1"
      - include: "#outline-inactive-level-2"
      - include: "#outline-inactive-level-3"
      - include: "#outline-inactive-level-4"
      - include: "#outline-inactive-level-5"
      - include: "#outline-inactive-level-6"
      - include: "#outline-inactive-level-more-than-6"
      - include: "#outline-active-level-1"
      - include: "#outline-active-level-2"
      - include: "#outline-active-level-3"
      - include: "#outline-active-level-4"
      - include: "#outline-active-level-5"
      - include: "#outline-active-level-6"
      - include: "#outline-active-level-more-than-6"

  file-header:
    name: "{{scopes.META_HEADER}}"
    begin: "{{regexs.fileHeaderBeginRegex}}" # Anchor to start only if not immediately a headline.
    end: "{{regexs.headlineDetectToCloseBlockRegex}}" # End before the first headline.
    patterns:
      - include: "#line-comments"
      - include: "#blocks"
      - include: "#keyword-like-lines"
      - include: "#lists"
      - include: "#paragraph"

  section-content:
    name: "{{scopes.META_SECTION}}"
    begin: "{{regexs.sectionContentBeginRegex}}"
    end: "{{regexs.headlineDetectToCloseBlockRegex}}"
    patterns:
      - include: "#line-comments"
      - include: "#blocks"
      - include: "#keyword-like-lines"
      - include: "#lists"
      - include: "#paragraph"
  #endregion

  #region Outline Levels
  outline-level-base: &outline-level-base
    beginCaptures:
      "0":
        name: "{{scopes.HEADING_BLOCK}}"
        patterns:
          - include: "#headline-block"
    patterns:
      - include: "#section-content"

  outline-inactive-level-1:
    <<: *outline-level-base
    name: "{{scopes.META_OUTLINE_INACTIVE}} {{scopes.META_OUTLINE_1}}"
    begin: "{{regexs.inactiveHeadlineLevel1Regex}}"
    end: "{{regexs.outlineEndLevel1Regex}}"
    patterns:
      - include: "#outline-inactive-level-2"
      - include: "#outline-inactive-level-3"
      - include: "#outline-inactive-level-4"
      - include: "#outline-inactive-level-5"
      - include: "#outline-inactive-level-6"
      - include: "#outline-inactive-level-more-than-6"
      - include: "#outline-active-level-2"
      - include: "#outline-active-level-3"
      - include: "#outline-active-level-4"
      - include: "#outline-active-level-5"
      - include: "#outline-active-level-6"
      - include: "#outline-active-level-more-than-6"
      - include: "#section-content"

  outline-inactive-level-2:
    <<: *outline-level-base
    name: "{{scopes.META_OUTLINE_INACTIVE}} {{scopes.META_OUTLINE_2}}"
    begin: "{{regexs.inactiveHeadlineLevel2Regex}}"
    end: "{{regexs.outlineEndLevel2Regex}}"
    patterns:
      - include: "#outline-inactive-level-3"
      - include: "#outline-inactive-level-4"
      - include: "#outline-inactive-level-5"
      - include: "#outline-inactive-level-6"
      - include: "#outline-inactive-level-more-than-6"
      - include: "#outline-active-level-3"
      - include: "#outline-active-level-4"
      - include: "#outline-active-level-5"
      - include: "#outline-active-level-6"
      - include: "#outline-active-level-more-than-6"
      - include: "#section-content"

  outline-inactive-level-3:
    <<: *outline-level-base
    name: "{{scopes.META_OUTLINE_INACTIVE}} {{scopes.META_OUTLINE_3}}"
    begin: "{{regexs.inactiveHeadlineLevel3Regex}}"
    end: "{{regexs.outlineEndLevel3Regex}}"
    patterns:
      - include: "#outline-inactive-level-4"
      - include: "#outline-inactive-level-5"
      - include: "#outline-inactive-level-6"
      - include: "#outline-inactive-level-more-than-6"
      - include: "#outline-active-level-4"
      - include: "#outline-active-level-5"
      - include: "#outline-active-level-6"
      - include: "#outline-active-level-more-than-6"
      - include: "#section-content"
  outline-inactive-level-4:
    <<: *outline-level-base
    name: "{{scopes.META_OUTLINE_INACTIVE}} {{scopes.META_OUTLINE_4}}"
    begin: "{{regexs.inactiveHeadlineLevel4Regex}}"
    end: "{{regexs.outlineEndLevel4Regex}}"
    patterns:
      - include: "#outline-inactive-level-5"
      - include: "#outline-inactive-level-6"
      - include: "#outline-inactive-level-more-than-6"
      - include: "#outline-active-level-5"
      - include: "#outline-active-level-6"
      - include: "#outline-active-level-more-than-6"
      - include: "#section-content"

  outline-inactive-level-5:
    <<: *outline-level-base
    name: "{{scopes.META_OUTLINE_INACTIVE}} {{scopes.META_OUTLINE_5}}"
    begin: "{{regexs.inactiveHeadlineLevel5Regex}}"
    end: "{{regexs.outlineEndLevel5Regex}}"
    patterns:
      - include: "#outline-inactive-level-6"
      - include: "#outline-inactive-level-more-than-6"
      - include: "#outline-active-level-6"
      - include: "#outline-active-level-more-than-6"
      - include: "#section-content"

  outline-inactive-level-6:
    <<: *outline-level-base
    name: "{{scopes.META_OUTLINE_INACTIVE}} {{scopes.META_OUTLINE_6}}"
    begin: "{{regexs.inactiveHeadlineLevel6Regex}}"
    end: "{{regexs.outlineEndLevel6Regex}}"
    patterns:
      - include: "#outline-inactive-level-more-than-6"
      - include: "#outline-active-level-more-than-6"
      - include: "#section-content"

  outline-inactive-level-more-than-6:
    <<: *outline-level-base
    name: "{{scopes.META_OUTLINE_INACTIVE}} {{scopes.META_OUTLINE_MORE_THAN_6}}"
    begin: "{{regexs.inactiveHeadlineLevelMoreThan6Regex}}"
    end: "{{regexs.headlineDetectToCloseBlockRegex}}" # Any headline terminates this
    patterns:
      - include: "#outline-inactive-level-more-than-6"
      - include: "#outline-active-level-more-than-6"
      - include: "#section-content"

  outline-active-level-1:
    <<: *outline-level-base
    name: "{{scopes.META_OUTLINE_1}}"
    begin: "{{regexs.headlineLevel1Regex}}"
    end: "{{regexs.outlineEndLevel1Regex}}"
    patterns:
      - include: "#outline-inactive-level-2"
      - include: "#outline-inactive-level-3"
      - include: "#outline-inactive-level-4"
      - include: "#outline-inactive-level-5"
      - include: "#outline-inactive-level-6"
      - include: "#outline-inactive-level-more-than-6"
      - include: "#outline-active-level-2"
      - include: "#outline-active-level-3"
      - include: "#outline-active-level-4"
      - include: "#outline-active-level-5"
      - include: "#outline-active-level-6"
      - include: "#outline-active-level-more-than-6"
      - include: "#section-content"

  outline-active-level-2:
    <<: *outline-level-base
    name: "{{scopes.META_OUTLINE_2}}"
    begin: "{{regexs.headlineLevel2Regex}}"
    end: "{{regexs.outlineEndLevel2Regex}}"
    patterns:
      - include: "#outline-inactive-level-3"
      - include: "#outline-inactive-level-4"
      - include: "#outline-inactive-level-5"
      - include: "#outline-inactive-level-6"
      - include: "#outline-inactive-level-more-than-6"
      - include: "#outline-active-level-3"
      - include: "#outline-active-level-4"
      - include: "#outline-active-level-5"
      - include: "#outline-active-level-6"
      - include: "#outline-active-level-more-than-6"
      - include: "#section-content"

  outline-active-level-3:
    <<: *outline-level-base
    name: "{{scopes.META_OUTLINE_3}}"
    begin: "{{regexs.headlineLevel3Regex}}"
    end: "{{regexs.outlineEndLevel3Regex}}"
    patterns:
      - include: "#outline-inactive-level-4"
      - include: "#outline-inactive-level-5"
      - include: "#outline-inactive-level-6"
      - include: "#outline-inactive-level-more-than-6"
      - include: "#outline-active-level-4"
      - include: "#outline-active-level-5"
      - include: "#outline-active-level-6"
      - include: "#outline-active-level-more-than-6"
      - include: "#section-content"
  outline-active-level-4:
    <<: *outline-level-base
    name: "{{scopes.META_OUTLINE_4}}"
    begin: "{{regexs.headlineLevel4Regex}}"
    end: "{{regexs.outlineEndLevel4Regex}}"
    patterns:
      - include: "#outline-inactive-level-5"
      - include: "#outline-inactive-level-6"
      - include: "#outline-inactive-level-more-than-6"
      - include: "#outline-active-level-5"
      - include: "#outline-active-level-6"
      - include: "#outline-active-level-more-than-6"
      - include: "#section-content"

  outline-active-level-5:
    <<: *outline-level-base
    name: "{{scopes.META_OUTLINE_5}}"
    begin: "{{regexs.headlineLevel5Regex}}"
    end: "{{regexs.outlineEndLevel5Regex}}"
    patterns:
      - include: "#outline-inactive-level-6"
      - include: "#outline-inactive-level-more-than-6"
      - include: "#outline-active-level-6"
      - include: "#outline-active-level-more-than-6"
      - include: "#section-content"

  outline-active-level-6:
    <<: *outline-level-base
    name: "{{scopes.META_OUTLINE_6}}"
    begin: "{{regexs.headlineLevel6Regex}}"
    end: "{{regexs.outlineEndLevel6Regex}}"
    patterns:
      - include: "#outline-inactive-level-more-than-6"
      - include: "#outline-active-level-more-than-6"
      - include: "#section-content"

  outline-active-level-more-than-6:
    <<: *outline-level-base
    name: "{{scopes.META_OUTLINE_MORE_THAN_6}}" # Re-use level 6 scope for deep headlines
    begin: "{{regexs.headlineLevelMoreThan6Regex}}"
    end: "{{regexs.headlineDetectToCloseBlockRegex}}" # Any headline terminates this
    patterns:
      - include: "#outline-inactive-level-more-than-6"
      - include: "#outline-active-level-more-than-6"
      - include: "#section-content"
  #endregion

  #region Content Elements

  #region Headings
  headline-captures: &headline-captures
    "1": { name: "{{scopes.HEADING_PUNCTUATION}}" }
    "2": { name: "{{scopes.TODO_KEYWORD}}" }
    "3": { name: "{{scopes.PRIORITY_COOKIE}}" }
    "4": { name: "{{scopes.PRIORITY_VALUE}}" }
    "5":
      name: "{{scopes.HEADING_TITLE}}"
      patterns: *inline-markup-patterns
    "6": { name: "{{scopes.PROGRESS_COOKIE}}" }
    "7": { name: "{{scopes.TAG}}" }

  headline-block:
    name: "{{scopes.HEADING_BLOCK}}"
    patterns:
      - name: "{{scopes.HEADING_LEVEL_1}}"
        match: "{{regexs.headlineLevel1Regex}}"
        captures: { <<: *headline-captures }
      - name: "{{scopes.HEADING_LEVEL_2}}"
        match: "{{regexs.headlineLevel2Regex}}"
        captures: { <<: *headline-captures }
      - name: "{{scopes.HEADING_LEVEL_3}}"
        match: "{{regexs.headlineLevel3Regex}}"
        captures: { <<: *headline-captures }
      - name: "{{scopes.HEADING_LEVEL_4}}"
        match: "{{regexs.headlineLevel4Regex}}"
        captures: { <<: *headline-captures }
      - name: "{{scopes.HEADING_LEVEL_5}}"
        match: "{{regexs.headlineLevel5Regex}}"
        captures: { <<: *headline-captures }
      - name: "{{scopes.HEADING_LEVEL_6}}"
        match: "{{regexs.headlineLevel6Regex}}"
        captures: { <<: *headline-captures }
      - name: "{{scopes.HEADING_LEVEL_MORE_THAN_6}}"
        match: "{{regexs.headlineLevelMoreThan6Regex}}"
        captures: { <<: *headline-captures }
  #endregion

  #region Keywords & Directives
  keyword-like-lines:
    name: "{{scopes.META_DIRECTIVE}}"
    patterns:
      - include: "#include-directive"
      - include: "#planning-lines"
      - include: "#link-abbreviations"
      - include: "#macro-definition"
      - include: "#keywords"

  include-directive:
    name: "{{scopes.META_DIRECTIVE}}"
    begin: "{{regexs.includeDirectiveBeginRegex}}"
    end: "{{regexs.endOfLine}}" # End at the end of the line
    beginCaptures:
      "1": { name: "{{scopes.INCLUDE_KEYWORD}}" }
      "2": { name: "{{scopes.INCLUDE_PATH}}" }
    patterns:
      - include: "#block-parameter-pair"

  keywords:
    name: "{{scopes.KEYWORD}}"
    match: "{{regexs.genericKeywordRegex}}"
    captures:
      "1": { name: "{{scopes.KEYWORD_KEY}}" }
      "2": { name: "{{scopes.KEYWORD_NAME}}" }
      "3": { name: "{{scopes.KEYWORD_VALUE}}" }

  link-abbreviations:
    match: "{{regexs.linkAbbreviationRegex}}"
    name: "{{scopes.LINK_ABBREVIATION_META}}"
    captures:
      "2": { name: "{{scopes.LINK_ABBREVIATION_KEYWORD}}" }
      "3": { name: "{{scopes.LINK_ABBREVIATION_KEY}}" }
      "4": { name: "{{scopes.LINK_ABBREVIATION_URL}}" }

  macro-definition:
    match: "{{regexs.macroDefinitionRegex}}"
    name: "{{scopes.KEYWORD}}"
    captures:
      "1": { name: "{{scopes.KEYWORD_KEY}}" }
      "2": { name: "{{scopes.MACRO_NAME}}" }
      "3":
        name: "{{scopes.KEYWORD_VALUE}}"
        patterns:
          - match: "(\\$[0-9]+)"
            name: "{{scopes.MACRO_PARAMETER}}"

  planning-lines:
    name: "{{scopes.PLANNING_LINE_META}}"
    match: "{{regexs.planningLineRegex}}"
    captures:
      "1": { name: "{{scopes.PLANNING_KEYWORD}}" }
      "2":
        name: "{{scopes.PLANNING_TIMESTAMP}}"
        patterns:
          - include: "#timestamps"
  #endregion

  #region Blocks
  blocks:
    name: "{{scopes.META_BLOCK}}"
    patterns:
      - include: "#begin-end-blocks"
      - include: "#latex-environment-block"
      - include: "#drawer-blocks"
      - include: "#tables"
      - include: "#horizontal-rules"

  block-captures: &block-captures
    "1": { name: "{{scopes.LEADING_WHITESPACE}}" }
    "2": { name: "{{scopes.BLOCK_KEYWORD}}" }
    "3": { name: "{{scopes.BLOCK_NAME}}" }
    "4":
      name: "{{scopes.BLOCK_PARAMETERS}}"
      patterns:
        - include: "#block-parameter-pair"

  end-captures: &end-captures
    "1": { name: "{{scopes.LEADING_WHITESPACE}}" }
    "2": { name: "{{scopes.BLOCK_KEYWORD}}" }
    "3": { name: "{{scopes.BLOCK_NAME}}" }

  block-parameter-pair:
    match: "{{regexs.blockParameterRegex}}"
    captures:
      "1": { name: "{{scopes.BLOCK_PARAMETER_KEY}}" }
      "2": { name: "{{scopes.BLOCK_PARAMETER_VALUE}}" }

  horizontal-rules:
    name: "{{scopes.HORIZONTAL_RULE}}"
    match: "{{regexs.horizontalRuleRegex}}"

  #region Begin/End Blocks
  begin-end-blocks:
    name: "{{scopes.META_BEGIN_END_BLOCK}}"
    patterns:
      - include: "#comment-block"
      - include: "#standard-blocks"
      - include: "#dynamic-blocks"
      - include: "#org-src-blocks"
      - include: "#customized-blocks"

  comment-block:
    name: "{{scopes.COMMENT_BLOCK}}"
    begin: "{{regexs.commentBlockBeginRegex}}"
    end: "{{regexs.commentBlockEndRegex}}"
    contentName: "{{scopes.COMMENT_BLOCK_CONTENT}}"
    beginCaptures:
      "2": { name: "{{scopes.BLOCK_KEYWORD}}" }
    endCaptures:
      "2": { name: "{{scopes.BLOCK_KEYWORD}}" }

  standard-blocks:
    patterns:
      - name: "{{scopes.META_BEGIN_END_BLOCK}} {{scopes.BLOCK_STANDARD_META}}"
        contentName: "{{scopes.BLOCK_CONTENT}} {{scopes.BLOCK_STANDARD_CONTENT}}"
        begin: "{{regexs.standardBlockVerbatimBeginRegex}}"
        end: "{{regexs.standardBlockVerbatimEndRegex}}"
        beginCaptures: { <<: *block-captures }
        endCaptures: { <<: *end-captures }
      - name: "{{scopes.META_BEGIN_END_BLOCK}} {{scopes.BLOCK_STANDARD_META}}"
        contentName: "{{scopes.BLOCK_CONTENT}} {{scopes.BLOCK_STANDARD_CONTENT}}"
        begin: "{{regexs.standardBlockMarkupBeginRegex}}"
        end: "{{regexs.standardBlockMarkupEndRegex}}"
        beginCaptures: { <<: *block-captures }
        endCaptures: { <<: *end-captures }
        patterns: *inline-markup-patterns

  dynamic-blocks:
    name: "{{scopes.META_BEGIN_END_BLOCK}} {{scopes.DYNAMIC_BLOCK_META}}"
    contentName: "{{scopes.BLOCK_CONTENT}} {{scopes.DYNAMIC_BLOCK_CONTENT}}"
    begin: "{{regexs.dynamicBlockBeginRegex}}"
    end: "{{regexs.dynamicBlockEndRegex}}"
    beginCaptures: { <<: *block-captures }
    endCaptures: { <<: *end-captures }
    patterns: *inline-markup-patterns

  customized-blocks:
    name: "{{scopes.META_BEGIN_END_BLOCK}} {{scopes.BLOCK_CUSTOMIZED_META}}"
    contentName: "{{scopes.BLOCK_CONTENT}} {{scopes.BLOCK_CUSTOMIZED_CONTENT}}"
    begin: "{{regexs.customizedBlockBeginRegex}}"
    end: "{{regexs.customizedBlockEndRegex}}"
    beginCaptures: { <<: *block-captures }
    endCaptures: { <<: *end-captures }
    patterns: *inline-markup-patterns

  org-src-blocks: { patterns: [] } # Injected by build script

  latex-environment-block:
    name: "{{scopes.LATEX}}"
    begin: "{{regexs.latexEnvironmentBeginRegex}}"
    end: "{{regexs.latexEnvironmentEndRegex}}"
    beginCaptures:
      "0": { name: "keyword.control.math.block.latex" }
    endCaptures:
      "0": { name: "keyword.control.math.block.latex" }
  #endregion

  #region Drawers
  drawer-blocks:
    name: "{{scopes.META_DRAWER}}"
    patterns:
      - include: "#property-drawer"
      - include: "#drawers"

  property-drawer:
    name: "{{scopes.META_DRAWER}} {{scopes.PROPERTY_DRAWER_META}}"
    begin: "{{regexs.propertyDrawerBeginRegex}}"
    end: "{{regexs.drawerEndRegex}}"
    beginCaptures:
      "0": { name: "{{scopes.DRAWER_BEGIN_KEYWORD}}" }
    endCaptures:
      "0": { name: "{{scopes.DRAWER_END_KEYWORD}}" }
    patterns:
      - include: "#property-line"

  property-line:
    match: "{{regexs.propertyRegex}}"
    name: "{{scopes.PROPERTY_META}}"
    captures:
      "1": { name: "{{scopes.PROPERTY_KEY}}" }
      "2": { name: "{{scopes.PROPERTY_VALUE}}" }

  drawers:
    name: "{{scopes.META_DRAWER}}"
    contentName: "{{scopes.DRAWER_CONTENT}}"
    begin: "{{regexs.genericDrawerBeginRegex}}"
    end: "{{regexs.drawerEndRegex}}"
    beginCaptures:
      "0": { name: "{{scopes.DRAWER_BEGIN_KEYWORD}}" }
      "1": { name: "{{scopes.DRAWER_NAME}}" }
    endCaptures:
      "0": { name: "{{scopes.DRAWER_END_KEYWORD}}" }
  #endregion
  #endregion

  #region Lists
  lists:
    patterns:
      - name: "{{scopes.LIST_UNORDERED_TEXT}}"
        begin: "{{regexs.unorderedListRegex}}"
        end: "{{regexs.endOfLine}}"
        beginCaptures:
          "1": { name: "{{scopes.LEADING_WHITESPACE}}" }
          "2": { name: "{{scopes.LIST_BULLET}}" }
          "3": { name: "{{scopes.CHECKBOX}}" }
        patterns:
          - include: "#list-description-separator"
          - patterns: *inline-markup-patterns
      - name: "{{scopes.LIST_ORDERED_TEXT}}"
        begin: "{{regexs.orderedListRegex}}"
        end: "{{regexs.endOfLine}}"
        beginCaptures:
          "1": { name: "{{scopes.LEADING_WHITESPACE}}" }
          "2": { name: "{{scopes.LIST_BULLET}}" }
          "3": { name: "{{scopes.CHECKBOX}}" }
        patterns:
          - include: "#list-counter"
          - patterns: *inline-markup-patterns

  list-description-separator:
    match: "{{regexs.descriptionSeparatorRegex}}"
    captures:
      "1": { name: "{{scopes.DESCRIPTION_TERM}}" }
      "2": { name: "{{scopes.DESCRIPTION_SEPARATOR}}" }

  list-counter:
    match: "{{regexs.listCounterRegex}}"
    name: "{{scopes.LIST_COUNTER}}"
    captures:
      "1": { name: "{{scopes.LIST_COUNTER_VALUE}}" }
  #endregion

  #region Tables
  tables:
    name: "{{scopes.META_TABLE}}"
    contentName: "{{scopes.TABLE_CONTENT}}"
    begin: "(?={{regexs.tableRegex}})"
    end: "(?={{regexs.emptyLine}}|{{regexs.headlineDetectToCloseBlockRegex}})"
    beginCaptures:
      "0": { name: "{{scopes.TABLE_META}}" }
    patterns:
      - include: "#line-comments"
      - match: "{{regexs.tableRowSeparatorLine}}"
        name: "{{scopes.TABLE_ROW_SEPARATOR}}"
      - begin: "{{regexs.tableRowBeginRegex}}"
        name: "{{scopes.TABLE_ROW}}"
        contentName: "{{scopes.TABLE_CONTENT}} {{scopes.TABLE_ROW}}"
        end: "{{regexs.endOfLine}}"
        patterns:
          - begin: "{{regexs.tableCellBeginRegex}}"
            beginCaptures:
              "0": { name: "{{scopes.TABLE_CELL_PUNCTUATION}}" }
            contentName: "{{scopes.TABLE_CELL}}"
            end: "{{regexs.tableCellEndRegex}}"
            patterns: *inline-markup-patterns
  #endregion

  #region Comments
  # Handles line comments. For block comments (#+BEGIN_COMMENT),                                 │
  # see #comment-block inside the 'Blocks > Begin/End Blocks' region.

  line-comments:
    begin: "{{regexs.lineCommentBeginCaptureRegex}}"
    end: "{{regexs.endOfLine}}"
    name: "{{scopes.COMMENT_LINE}}"
    beginCaptures:
      "1": { name: "{{scopes.PUNCTUATION_WHITESPACE}}" }
    patterns: *inline-markup-patterns
  #endregion

  #region Inline Markup
  timestamps:
    patterns:
      - name: "{{scopes.TIMESTAMP_ACTIVE_RANGE}}"
        match: "{{regexs.timestampActiveRangeRegex}}"
      - name: "{{scopes.TIMESTAMP_INACTIVE_RANGE}}"
        match: "{{regexs.timestampInactiveRangeRegex}}"
      - name: "{{scopes.TIMESTAMP_ACTIVE}}"
        match: "{{regexs.timestampActiveRegex}}"
      - name: "{{scopes.TIMESTAMP_INACTIVE}}"
        match: "{{regexs.timestampInactiveRegex}}"

  entities:
    name: "{{scopes.ENTITY}}"
    match: "{{regexs.entitiesRegex}}"

  sub-super-scripts:
    name: "{{scopes.SUB_SUPER_SCRIPT}}"
    match: "{{regexs.subSuperScriptRegex}}"

  latex-inline:
    name: "{{scopes.LATEX}}"
    match: "{{regexs.latexInlineRegex}}"

  #region Links
  plain-link:
    name: "{{scopes.LINK_PLAIN}}"
    match: "{{regexs.plainLinkRegex}}"

  angle-bracket-link:
    name: "{{scopes.LINK_ANGLE}}"
    match: "{{regexs.angleBracketLinkRegex}}"

  links:
    match: "{{regexs.linkRegex}}"
    name: "{{scopes.LINK_META}}"
    captures:
      "1": { name: "{{scopes.LINK_BEGIN_PUNCTUATION}}" }
      "2":
        name: "{{scopes.LINK}}"
        patterns:
          - include: "#link-protocol"
      "3": { name: "{{scopes.LINK_SEPARATOR_PUNCTUATION}}" }
      "4": { name: "{{scopes.LINK_DESCRIPTION}}" }
      "5": { name: "{{scopes.LINK_END_PUNCTUATION}}" }

  link-protocol:
    match: "{{regexs.linkProtocolRegex}}"
    captures:
      "1": { name: "{{scopes.LINK_PROTOCOL}}" }
  #endregion

  #region Footnotes
  footnotes:
    patterns:
      # Unified rule for all footnote definitions
      - name: "{{scopes.FOOTNOTE_DEFINITION}}"
        begin: "{{regexs.footnoteDefinitionStartRegex}}"
        end: "{{regexs.footnoteDefinitionEndRegex}}"
        beginCaptures:
          "1": { name: "{{scopes.LEADING_WHITESPACE}}" }
          "2": { name: "{{scopes.FOOTNOTE_PUNCTUATION}}" }
          "3": { name: "{{scopes.FOOTNOTE_LABEL}}" }
          "4": { name: "{{scopes.PUNCTUATION_WHITESPACE}}" }
          "5":
            {
              name: "{{scopes.FOOTNOTE_CONTENT}}",
              patterns: *inline-markup-patterns,
            }
        patterns:
          - name: "{{scopes.FOOTNOTE_CONTENT}}"
            match: '.*\S.*'
            patterns: *inline-markup-patterns

      # Rule 3: Inline anonymous definition
      - match: "{{regexs.footnoteInlineDefinitionRegex}}"
        name: "{{scopes.FOOTNOTE_REFERENCE}} {{scopes.FOOTNOTE_PUNCTUATION}}"
        captures:
          "1": { name: "{{scopes.FOOTNOTE_CONTENT}}" }

      # Rule 4: Standard reference
      - match: "{{regexs.footnoteReferenceRegex}}"
        name: "{{scopes.FOOTNOTE_REFERENCE}} {{scopes.FOOTNOTE_PUNCTUATION}}"
        captures:
          "1": { name: "{{scopes.FOOTNOTE_LABEL}}" }

      # Rule 5: Anonymous reference
      - match: "{{regexs.footnoteAnonymousReferenceRegex}}"
        name: "{{scopes.FOOTNOTE_REFERENCE}} {{scopes.FOOTNOTE_PUNCTUATION}}"
  #endregion

  #region Macros
  macros:
    name: "{{scopes.META_INLINE_MACRO}}"
    match: "{{regexs.inlineMacroRegex}}"
    captures:
      "1":
        name: "{{scopes.MACRO_PUNCTUATION}}"
      "2":
        name: "{{scopes.MACRO}}"
        patterns:
          - match: "{{regexs.macroNameFragment}}"
            name: "{{scopes.MACRO_NAME}}"
          - match: "{{regexs.macroArgsFragment}}"
            name: "{{scopes.MACRO_PARAMETER}}"
      "3":
        name: "{{scopes.MACRO_PUNCTUATION}}"
  #endregion

  #region Emphasis & Verbatim
  bold:
    name: "{{scopes.META_INLINE_BOLD}}"
    contentName: "{{scopes.BOLD}}"
    begin: "{{regexs.boldBeginRegex}}"
    end: "{{regexs.boldEndRegex}}"
    beginCaptures:
      "1": { name: "{{scopes.BOLD_PUNCTUATION}}" }
    endCaptures:
      "1": { name: "{{scopes.BOLD_PUNCTUATION}}" }
    patterns: *inline-markup-patterns

  italic:
    name: "{{scopes.META_INLINE_ITALIC}}"
    contentName: "{{scopes.ITALIC}}"
    begin: "{{regexs.italicBeginRegex}}"
    end: "{{regexs.italicEndRegex}}"
    beginCaptures:
      "1": { name: "{{scopes.ITALIC_PUNCTUATION}}" }
    endCaptures:
      "1": { name: "{{scopes.ITALIC_PUNCTUATION}}" }
    patterns: *inline-markup-patterns

  underline:
    name: "{{scopes.META_INLINE_UNDERLINE}}"
    contentName: "{{scopes.UNDERLINE}}"
    begin: "{{regexs.underlineBeginRegex}}"
    end: "{{regexs.underlineEndRegex}}"
    beginCaptures:
      "1": { name: "{{scopes.UNDERLINE_PUNCTUATION}}" }
    endCaptures:
      "1": { name: "{{scopes.UNDERLINE_PUNCTUATION}}" }
    patterns: *inline-markup-patterns

  strikethrough:
    name: "{{scopes.META_INLINE_STRIKETHROUGH}}"
    contentName: "{{scopes.STRIKETHROUGH}}"
    begin: "{{regexs.strikethroughBeginRegex}}"
    end: "{{regexs.strikethroughEndRegex}}"
    beginCaptures:
      "1": { name: "{{scopes.STRIKETHROUGH_PUNCTUATION}}" }
    endCaptures:
      "1": { name: "{{scopes.STRIKETHROUGH_PUNCTUATION}}" }
    patterns: *inline-markup-patterns

  code:
    name: "{{scopes.META_INLINE_CODE}}"
    contentName: "{{scopes.CODE}}"
    begin: "{{regexs.codeBeginRegex}}"
    end: "{{regexs.codeEndRegex}}"
    beginCaptures:
      "1": { name: "{{scopes.CODE_PUNCTUATION}}" }
    endCaptures:
      "1": { name: "{{scopes.CODE_PUNCTUATION}}" }

  verbatim:
    name: "{{scopes.META_INLINE_VERBATIM}}"
    contentName: "{{scopes.VERBATIM}}"
    begin: "{{regexs.verbatimBeginRegex}}"
    end: "{{regexs.verbatimEndRegex}}"
    beginCaptures:
      "1": { name: "{{scopes.VERBATIM_PUNCTUATION}}" }
    endCaptures:
      "1": { name: "{{scopes.VERBATIM_PUNCTUATION}}" }
  #endregion
  #endregion

  #region Paragraphs
  paragraph:
    name: "{{scopes.META_PARAGRAPH}} {{scopes.PARAGRAPH}}"
    begin: "{{regexs.paragraphBeginRegex}}"
    end: "{{regexs.paragraphEndRegex}}"
    patterns: *inline-markup-patterns
  #endregion

  #endregion
