#+TITLE: Test Suite for Headlines


#+BEGIN_COMMENT :description Expected Scopes & Capture Groups:

* === Block Scopes ===
# The following scopes are applied to the entire headline.
- markup.heading.org
- heading.1.org, heading.2.org, etc.

* === Capture Group Scopes ===
# The following scopes are applied to the specific parts of the headline.
1. stars -> punctuation.definition.heading.org
2. todo -> keyword.other.todo.org
3. priority block -> constant.other.priority.org
4. priority letter -> constant.other.priority.value.org
5. headline text -> entity.name.section.org
6. progress/cookie -> constant.other.progress.org
7. tags -> entity.name.tag.org
#+END_COMMENT

* Normal Cases

#+NAME: Simple headline (Level 1)
#+BEGIN_FIXTURE
* Simple headline
#+END_FIXTURE
#+EXPECTED: headlineLevel1Regex
| Group # | Expected Value  |
|---------+-----------------|
| 1       | *               |
| 5       | Simple headline |
#+EXPECTED: headlineDetectRegex
| Group # | Expected Value    |
|---------+-------------------|
| 1       | * Simple headline |

#+NAME: Complete headline with all elements
#+BEGIN_FIXTURE
* TODO [#A] Complete headline example [2/5] :work:project:
#+END_FIXTURE
#+EXPECTED: headlineLevel1Regex
| Group # | Expected Value            |
|---------+---------------------------|
| 1       | *                         |
| 2       | TODO                      |
| 3       | [#A]                      |
| 4       | A                         |
| 5       | Complete headline example |
| 6       | [2/5]                     |
| 7       | :work:project:            |
#+EXPECTED: headlineDetectRegex
| Group # | Expected Value                                          |
|---------+---------------------------------------------------------|
| 1       | * TODO [#A] Complete headline example [2/5] :work:project: |

#+NAME: Multi-level headline with TODO (Level 2)
#+BEGIN_FIXTURE
** DONE Multi-level task
#+END_FIXTURE
#+EXPECTED: headlineLevel2Regex
| Group # | Expected Value   |
|---------+------------------|
| 1       | **               |
| 2       | DONE             |
| 5       | Multi-level task |
#+EXPECTED: headlineDetectRegex
| Group # | Expected Value          |
|---------+-------------------------|
| 1       | ** DONE Multi-level task |

#+NAME: Priority without TODO (Level 3)
#+BEGIN_FIXTURE
*** [#B] Priority headline without todo
#+END_FIXTURE
#+EXPECTED: headlineLevel3Regex
| Group # | Expected Value                 |
|---------+--------------------------------|
| 1       | ***                            |
| 3       | [#B]                           |
| 4       | B                              |
| 5       | Priority headline without todo |
#+EXPECTED: headlineDetectRegex
| Group # | Expected Value                           |
|---------+------------------------------------------|
| 1       | *** [#B] Priority headline without todo |

#+NAME: Complex headline with unicode and symbols (Level 4)
#+BEGIN_FIXTURE
**** WAITING [#C] 复杂标题 with symbols !@#$% :chinese:symbols:
#+END_FIXTURE
#+EXPECTED: headlineLevel4Regex
| Group # | Expected Value              |
|---------+-----------------------------|
| 1       | ****                        |
| 2       | WAITING                     |
| 3       | [#C]                        |
| 4       | C                           |
| 5       | 复杂标题 with symbols !@#$% |
| 7       | :chinese:symbols:           |
#+EXPECTED: headlineDetectRegex
| Group # | Expected Value                                                  |
|---------+-----------------------------------------------------------------|
| 1       | **** WAITING [#C] 复杂标题 with symbols !@#$% :chinese:symbols: |

#+NAME: Level 5 headline
#+BEGIN_FIXTURE
***** A level 5 headline
#+END_FIXTURE
#+EXPECTED: headlineLevel5Regex
| Group # | Expected Value       |
|---------+----------------------|
| 1       | *****                |
| 5       | A level 5 headline   |
#+EXPECTED: headlineDetectRegex
| Group # | Expected Value           |
|---------+--------------------------|
| 1       | ***** A level 5 headline |

#+NAME: Very deep level headline (Level 6)
#+BEGIN_FIXTURE
****** NEXT [#A] Deep level headline :deep:level:nested:
#+END_FIXTURE
#+EXPECTED: headlineLevel6Regex
| Group # | Expected Value        |
|---------+-----------------------|
| 1       | ******                |
| 2       | NEXT                  |
| 3       | [#A]                  |
| 4       | A                     |
| 5       | Deep level headline   |
| 7       | :deep:level:nested:   |
#+EXPECTED: headlineDetectRegex
| Group # | Expected Value                                          |
|---------+---------------------------------------------------------|
| 1       | ****** NEXT [#A] Deep level headline :deep:level:nested: |

#+NAME: Headline with too many stars (7)
#+BEGIN_FIXTURE
******* Too many stars
#+END_FIXTURE
#+EXPECTED: headlineLevel6Regex
| Group # | Expected Value   |
|---------+------------------|
| 1       | *******          |
| 5       | Too many stars   |
#+EXPECTED: headlineDetectRegex
| Group # | Expected Value         |
|---------+------------------------|
| 1       | ******* Too many stars |

* Edge Cases

#+NAME: No space after stars
#+BEGIN_FIXTURE
*TODO No space
#+END_FIXTURE
#+EXPECTED: headlineLevel1Regex
no-match
#+EXPECTED: headlineDetectRegex
no-match

#+NAME: Multiple spaces between elements
#+BEGIN_FIXTURE
*    TODO    Headline    :tag:
#+END_FIXTURE
#+EXPECTED: headlineLevel1Regex
| Group # | Expected Value |
|---------+----------------|
| 1       | *              |
| 2       | TODO           |
| 5       | Headline       |
| 7       | :tag:          |
#+EXPECTED: headlineDetectRegex
| Group # | Expected Value                  |
|---------+---------------------------------|
| 1       | *    TODO    Headline    :tag: |

#+NAME: Multiple priorities
#+BEGIN_FIXTURE
* [#A][#B] Task
#+END_FIXTURE
#+EXPECTED: headlineLevel1Regex
| Group # | Expected Value |
|---------+----------------|
| 1       | *              |
| 3       | [#A]           |
| 4       | A              |
| 5       | [#B] Task      |
#+EXPECTED: headlineDetectRegex
| Group # | Expected Value       |
|---------+----------------------|
| 1       | * [#A][#B] Task |

#+NAME: Headline with only stars
#+BEGIN_FIXTURE
*
#+END_FIXTURE
#+EXPECTED: headlineLevel1Regex
no-match
#+EXPECTED: headlineDetectRegex
no-match

#+NAME: Headline with only tags
#+BEGIN_FIXTURE
* :tag1:
#+END_FIXTURE
#+EXPECTED: headlineLevel1Regex
| Group # | Expected Value |
|---------+----------------|
| 1       | *              |
| 7       | :tag1:         |
#+EXPECTED: headlineDetectRegex
| Group # | Expected Value |
|---------+----------------|
| 1       | * :tag1:       |

#+NAME: Duplicate tags
#+BEGIN_FIXTURE
* Task :tag1:tag1:
#+END_FIXTURE
#+EXPECTED: headlineLevel1Regex
| Group # | Expected Value |
|---------+----------------|
| 1       | *              |
| 5       | Task           |
| 7       | :tag1:tag1:    |
#+EXPECTED: headlineDetectRegex
| Group # | Expected Value      |
|---------+---------------------|
| 1       | * Task :tag1:tag1: |

#+NAME: Tag with special characters
#+BEGIN_FIXTURE
* Task :tag$:@:tag!:
#+END_FIXTURE
#+EXPECTED: headlineLevel1Regex
| Group # | Expected Value |
|---------+----------------|
| 1       | *              |
| 5       | Task           |
| 7       | :tag$:@:tag!:  |
#+EXPECTED: headlineDetectRegex
| Group # | Expected Value        |
|---------+-----------------------|
| 1       | * Task :tag$:@:tag!: |

#+NAME: Timestamp in headline text
#+BEGIN_FIXTURE
* Task <2025-08-01 Fri>
#+END_FIXTURE
#+EXPECTED: headlineLevel1Regex
| Group # | Expected Value        |
|---------+-----------------------|
| 1       | *                     |
| 5       | Task <2025-08-01 Fri> |
#+EXPECTED: headlineDetectRegex
| Group # | Expected Value              |
|---------+-----------------------------|
| 1       | * Task <2025-08-01 Fri> |

#+NAME: Headline with inline markup
#+BEGIN_FIXTURE
* Headline /italic/ *bold* =code=
#+END_FIXTURE
#+EXPECTED: headlineLevel1Regex
| Group # | Expected Value                 |
|---------+--------------------------------|
| 1       | *                              |
| 5       | Headline /italic/ *bold* =code= |
#+EXPECTED: headlineDetectRegex
| Group # | Expected Value                       |
|---------+--------------------------------------|
| 1       | * Headline /italic/ *bold* =code= |

#+NAME: Malformed progress cookie
#+BEGIN_FIXTURE
* Project [abc%]
#+END_FIXTURE
#+EXPECTED: headlineLevel1Regex
| Group # | Expected Value |
|---------+----------------|
| 1       | *              |
| 5       | Project [abc%] |
#+EXPECTED: headlineDetectRegex
| Group # | Expected Value       |
|---------+----------------------|
| 1       | * Project [abc%] |

* Non-Matching Cases

#+NAME: Not a headline - no leading star
#+BEGIN_FIXTURE
This is not a headline.
#+END_FIXTURE
#+EXPECTED: headlineLevel1Regex
no-match
#+EXPECTED: headlineDetectRegex
no-match

#+NAME: Not a headline - star not at beginning of line
#+BEGIN_FIXTURE
  * This is not a headline.
#+END_FIXTURE
#+EXPECTED: headlineLevel1Regex
no-match
#+EXPECTED: headlineDetectRegex
no-match

#+NAME: Not a headline - list item
#+BEGIN_FIXTURE
- * This is a list item
#+END_FIXTURE
#+EXPECTED: headlineLevel1Regex
no-match
#+EXPECTED: headlineDetectRegex
no-match

#+NAME: Not a headline - escaped star
#+BEGIN_FIXTURE
\* This is not a headline
#+END_FIXTURE
#+EXPECTED: headlineLevel1Regex
no-match
#+EXPECTED: headlineDetectRegex
no-match
