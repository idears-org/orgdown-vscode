#+TITLE: Test Suite for Headlines

* Show Case

#+NAME: Complete headline with all elements
#+BEGIN_FIXTURE
,* TODO [#A] Complete headline example *inline bold* [2/5] :work:project:
#+END_FIXTURE
#+EXPECTED: :type regex :name headlineLevel1Regex
| Group # | Expected Value                           |
|---------+------------------------------------------|
| 1       | *                                        |
| 2       | TODO                                     |
| 3       | [#A]                                     |
| 4       | A                                        |
| 5       | Complete headline example *inline bold*  |
| 6       | [2/5]                                    |
| 7       | :work:project:                           |

#+EXPECTED: :type regex :name headlineDetectRegex
| Group # | Expected Value                                          |
|---------+---------------------------------------------------------|
| 1       | * TODO [#A] Complete headline example *inline bold* [2/5] :work:project: |

#+EXPECTED: :type scope
"* TODO [#A] Complete headline example *inline bold* [2/5] :work:project:" => {{scopes.HEADING_BLOCK}}, {{scopes.HEADING_LEVEL_1}}
  - "*" => {{scopes.HEADING_PUNCTUATION}}
  - "TODO" => {{scopes.TODO_KEYWORD}}
  - "[#A]" => {{scopes.PRIORITY_COOKIE}}
  - "Complete headline example *inline bold*" => {{scopes.HEADING_TITLE}}
    - "inline bold" => {{scopes.META_INLINE_BOLD}}
  - "[2/5]" => {{scopes.PROGRESS_COOKIE}}
  - ":work:project:" => {{scopes.TAG}}

* Normal Cases

#+NAME: Simple headline (Level 1)
#+BEGIN_FIXTURE
,* Simple headline
#+END_FIXTURE

#+EXPECTED: :type regex :name headlineLevel1Regex
| Group # | Expected Value  |
|---------+-----------------|
| 1       | *               |
| 5       | Simple headline |

#+EXPECTED: :type regex :name headlineDetectRegex
| Group # | Expected Value    |
|---------+-------------------|
| 1       | * Simple headline |

#+NAME: Multi-level headline with TODO (Level 2)
#+BEGIN_FIXTURE
,** DONE Multi-level task
#+END_FIXTURE

#+EXPECTED: :type regex :name headlineLevel2Regex
| Group # | Expected Value   |
|---------+------------------|
| 1       | **               |
| 2       | DONE             |
| 5       | Multi-level task |

#+EXPECTED: :type regex :name headlineDetectRegex
| Group # | Expected Value          |
|---------+-------------------------|
| 1       | ** DONE Multi-level task |

#+NAME: Priority without TODO (Level 3)
#+BEGIN_FIXTURE
,*** [#B] Priority headline without todo
#+END_FIXTURE

#+EXPECTED: :type regex :name headlineLevel3Regex
| Group # | Expected Value                 |
|---------+--------------------------------|
| 1       | ***                            |
| 3       | [#B]                           |
| 4       | B                              |
| 5       | Priority headline without todo |

#+EXPECTED: :type regex :name headlineDetectRegex
| Group # | Expected Value                           |
|---------+------------------------------------------|
| 1       | *** [#B] Priority headline without todo |

#+NAME: Complex headline with unicode and symbols (Level 4)
#+BEGIN_FIXTURE
,**** WAITING [#C] 复杂标题 with symbols !@#$% :chinese:symbols:
#+END_FIXTURE

#+EXPECTED: :type regex :name headlineLevel4Regex
| Group # | Expected Value              |
|---------+-----------------------------|
| 1       | ****                        |
| 2       | WAITING                     |
| 3       | [#C]                        |
| 4       | C                           |
| 5       | 复杂标题 with symbols !@#$% |
| 7       | :chinese:symbols:           |

#+EXPECTED: :type regex :name headlineDetectRegex
| Group # | Expected Value                                                  |
|---------+-----------------------------------------------------------------|
| 1       | **** WAITING [#C] 复杂标题 with symbols !@#$% :chinese:symbols: |

#+NAME: Level 5 headline
#+BEGIN_FIXTURE
,***** A level 5 headline
#+END_FIXTURE

#+EXPECTED: :type regex :name headlineLevel5Regex
| Group # | Expected Value       |
|---------+----------------------|
| 1       | *****                |
| 5       | A level 5 headline   |

#+EXPECTED: :type regex :name headlineDetectRegex
| Group # | Expected Value           |
|---------+--------------------------|
| 1       | ***** A level 5 headline |

#+NAME: Very deep level headline (Level 6)
#+BEGIN_FIXTURE
,****** NEXT [#A] Deep level headline :deep:level:nested:
#+END_FIXTURE

#+EXPECTED: :type regex :name headlineLevel6Regex
| Group # | Expected Value        |
|---------+-----------------------|
| 1       | ******                |
| 2       | NEXT                  |
| 3       | [#A]                  |
| 4       | A                     |
| 5       | Deep level headline   |
| 7       | :deep:level:nested:   |

#+EXPECTED: :type regex :name headlineDetectRegex
| Group # | Expected Value                                          |
|---------+---------------------------------------------------------|
| 1       | ****** NEXT [#A] Deep level headline :deep:level:nested: |

#+NAME: Headline with too many stars (7)
#+BEGIN_FIXTURE
,******* Too many stars
#+END_FIXTURE

#+EXPECTED: :type regex :name headlineLevelMoreThan6Regex
| Group # | Expected Value   |
|---------+------------------|
| 1       | *******          |
| 5       | Too many stars   |

#+EXPECTED: :type regex :name headlineDetectRegex
| Group # | Expected Value         |
|---------+------------------------|
| 1       | ******* Too many stars |

* Edge Cases

#+NAME: No space after stars
#+BEGIN_FIXTURE
,*TODO No space
#+END_FIXTURE

#+EXPECTED: :type regex :name headlineLevel1Regex
no-match

#+EXPECTED: :type regex :name headlineDetectRegex
no-match

#+NAME: Multiple spaces between elements
#+BEGIN_FIXTURE
,*    TODO    Headline    :tag:
#+END_FIXTURE

#+EXPECTED: :type regex :name headlineLevel1Regex
| Group # | Expected Value |
|---------+----------------|
| 1       | *              |
| 2       | TODO           |
| 5       | Headline       |
| 7       | :tag:          |

#+EXPECTED: :type regex :name headlineDetectRegex
| Group # | Expected Value                  |
|---------+---------------------------------|
| 1       | *    TODO    Headline    :tag: |

#+NAME: Multiple priorities
#+BEGIN_FIXTURE
,* [#A][#B] Task
#+END_FIXTURE

#+EXPECTED: :type regex :name headlineLevel1Regex
| Group # | Expected Value |
|---------+----------------|
| 1       | *              |
| 3       | [#A]           |
| 4       | A              |
| 5       | [#B] Task      |

#+EXPECTED: :type regex :name headlineDetectRegex
| Group # | Expected Value       |
|---------+----------------------|
| 1       | * [#A][#B] Task |

#+NAME: Headline with only stars
#+BEGIN_FIXTURE
,*
#+END_FIXTURE

#+EXPECTED: :type regex :name headlineLevel1Regex
no-match

#+EXPECTED: :type regex :name headlineDetectRegex
no-match

#+NAME: Headline with only tags
#+BEGIN_FIXTURE
,* :tag1:
#+END_FIXTURE

#+EXPECTED: :type regex :name headlineLevel1Regex
| Group # | Expected Value |
|---------+----------------|
| 1       | *              |
| 7       | :tag1:         |

#+EXPECTED: :type regex :name headlineDetectRegex
| Group # | Expected Value |
|---------+----------------|
| 1       | * :tag1:       |

#+NAME: Duplicate tags
#+BEGIN_FIXTURE
,* Task :tag1:tag1:
#+END_FIXTURE

#+EXPECTED: :type regex :name headlineLevel1Regex
| Group # | Expected Value |
|---------+----------------|
| 1       | *              |
| 5       | Task           |
| 7       | :tag1:tag1:    |

#+EXPECTED: :type regex :name headlineDetectRegex
| Group # | Expected Value      |
|---------+---------------------|
| 1       | * Task :tag1:tag1: |

#+NAME: Tag with special characters
#+BEGIN_FIXTURE
,* Task :tag$:@:tag!:
#+END_FIXTURE

#+EXPECTED: :type regex :name headlineLevel1Regex
| Group # | Expected Value |
|---------+----------------|
| 1       | *              |
| 5       | Task           |
| 7       | :tag$:@:tag!:  |

#+EXPECTED: :type regex :name headlineDetectRegex
| Group # | Expected Value        |
|---------+-----------------------|
| 1       | * Task :tag$:@:tag!: |

#+NAME: Timestamp in headline text
#+BEGIN_FIXTURE
,* Task <2025-08-01 Fri>
#+END_FIXTURE

#+EXPECTED: :type regex :name headlineLevel1Regex
| Group # | Expected Value        |
|---------+-----------------------|
| 1       | *                     |
| 5       | Task <2025-08-01 Fri> |

#+EXPECTED: :type regex :name headlineDetectRegex
| Group # | Expected Value              |
|---------+-----------------------------|
| 1       | * Task <2025-08-01 Fri> |

#+NAME: Headline with inline markup
#+BEGIN_FIXTURE
,* Headline /italic/ *bold* =code=
#+END_FIXTURE

#+EXPECTED: :type regex :name headlineLevel1Regex
| Group # | Expected Value                 |
|---------+--------------------------------|
| 1       | *                              |
| 5       | Headline /italic/ *bold* =code= |

#+EXPECTED: :type regex :name headlineDetectRegex
| Group # | Expected Value                       |
|---------+--------------------------------------|
| 1       | * Headline /italic/ *bold* =code= |

#+NAME: Malformed progress cookie
#+BEGIN_FIXTURE
,* Project [abc%]
#+END_FIXTURE

#+EXPECTED: :type regex :name headlineLevel1Regex
| Group # | Expected Value |
|---------+----------------|
| 1       | *              |
| 5       | Project [abc%] |

#+EXPECTED: :type regex :name headlineDetectRegex
| Group # | Expected Value       |
|---------+----------------------|
| 1       | * Project [abc%] |

* Non-Matching Cases

#+NAME: Not a headline - no leading star
#+BEGIN_FIXTURE
,This is not a headline.
#+END_FIXTURE

#+EXPECTED: :type regex :name headlineLevel1Regex
no-match

#+EXPECTED: :type regex :name headlineDetectRegex
no-match

#+NAME: Not a headline - star not at beginning of line
#+BEGIN_FIXTURE
,  * This is not a headline.
#+END_FIXTURE

#+EXPECTED: :type regex :name headlineLevel1Regex
no-match

#+EXPECTED: :type regex :name headlineDetectRegex
no-match

#+NAME: Not a headline - list item
#+BEGIN_FIXTURE
,- * This is a list item
#+END_FIXTURE

#+EXPECTED: :type regex :name headlineLevel1Regex
no-match

#+EXPECTED: :type regex :name headlineDetectRegex
no-match

#+NAME: Not a headline - escaped star
#+BEGIN_FIXTURE
,\* This is not a headline
#+END_FIXTURE

#+EXPECTED: :type regex :name headlineLevel1Regex
no-match

#+EXPECTED: :type regex :name headlineDetectRegex
no-match


* Inactive Headlines

#+NAME: Inactive headline with COMMENT keyword
#+BEGIN_FIXTURE
,* COMMENT Inactive headline
#+END_FIXTURE

#+EXPECTED: :type regex :name inactiveHeadlineDetectRegex
| Group # | Expected Value              |
|---------+-----------------------------|
| 1       | * COMMENT Inactive headline |

#+EXPECTED: :type regex :name activeHeadlineDetectRegex
no-match

#+NAME: Inactive headline with ARCHIVE tag
#+BEGIN_FIXTURE
,* Inactive headline with tag :ARCHIVE:
#+END_FIXTURE

#+EXPECTED: :type regex :name inactiveHeadlineDetectRegex
| Group # | Expected Value                         |
|---------+----------------------------------------|
| 1       | * Inactive headline with tag :ARCHIVE: |

#+EXPECTED: :type regex :name activeHeadlineDetectRegex
no-match

#+NAME: Inactive headline with TODO and ARCHIVE tag
#+BEGIN_FIXTURE
,* TODO Inactive with tag and todo :ARCHIVE:
#+END_FIXTURE

#+EXPECTED: :type regex :name inactiveHeadlineDetectRegex
| Group # | Expected Value                             |
|---------+--------------------------------------------|
| 1       | * TODO Inactive with tag and todo :ARCHIVE: |

#+EXPECTED: :type regex :name activeHeadlineDetectRegex
no-match

#+NAME: Active headline with "comment" in text
#+BEGIN_FIXTURE
,* This is a comment about something
#+END_FIXTURE

#+EXPECTED: :type regex :name inactiveHeadlineDetectRegex
no-match

#+EXPECTED: :type regex :name activeHeadlineDetectRegex
| Group # | Expected Value                       |
|---------+--------------------------------------|
| 1       | * This is a comment about something |


* Inactive Subtree

#+NAME: Inactive parent with active-looking child
#+BEGIN_FIXTURE
,* COMMENT Inactive Parent
,** Active Child
#+END_FIXTURE

#+EXPECTED: :type scope
"* COMMENT Inactive Parent" => {{scopes.HEADING_BLOCK}}, {{scopes.HEADING_LEVEL_1}}, {{scopes.META_OUTLINE_INACTIVE}}
  - "*" => {{scopes.HEADING_PUNCTUATION}}
  - "COMMENT" => {{scopes.TODO_KEYWORD}}
  - "Inactive Parent" => {{scopes.HEADING_TITLE}}
"** Active Child" => {{scopes.HEADING_BLOCK}}, {{scopes.HEADING_LEVEL_2}}, {{scopes.META_OUTLINE_INACTIVE}}
  - "**" => {{scopes.HEADING_PUNCTUATION}}
  - "Active Child" => {{scopes.HEADING_TITLE}}

#+NAME: Scope for deep headlines
#+BEGIN_FIXTURE
,******* Level 7
,******** Level 8
#+END_FIXTURE

#+EXPECTED: :type scope
"******* Level 7" => {{scopes.HEADING_BLOCK}}, {{scopes.HEADING_LEVEL_MORE_THAN_6}}, {{scopes.META_OUTLINE_MORE_THAN_6}}
  - "*******" => {{scopes.HEADING_PUNCTUATION}}
  - "Level 7" => {{scopes.HEADING_TITLE}}
"******** Level 8" => {{scopes.HEADING_BLOCK}}, {{scopes.HEADING_LEVEL_MORE_THAN_6}}, {{scopes.META_OUTLINE_MORE_THAN_6}}
  - "********" => {{scopes.HEADING_PUNCTUATION}}
  - "Level 8" => {{scopes.HEADING_TITLE}}
